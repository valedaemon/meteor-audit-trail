{"version":3,"file":"/packages/valedaemon:audit-trail.js","sources":["valedaemon:audit-trail/valedaemon:audit-trail.js","valedaemon:audit-trail/reporting.html","valedaemon:audit-trail/reporting.js","valedaemon:audit-trail/router.js"],"names":[],"mappings":";;;;;;;;AAAA,wC;;AAEA,oB;AACA,U;AACA,sB;AACA,iB;AACA,S;AACA,yB;AACA,E;AACA,a;AACA,C;;AAEA,oB;AACA,6B;AACA,mB;AACA,C;;AAEA,M;AACA,2B;AACA,oC;AACA,mC;AACA,gC;AACA,oB;AACA,wB;AACA,sG;AACA,E;AACA,C;;AAEA,+C;AACA,mB;AACA,0B;AACA,4B;AACA,6B;AACA,yC;AACA,sB;AACA,qB;AACA,6G;AACA,sB;;AAEA,4B;AACA,oB;AACA,C;;;;;;;;;;;;;;;;;;;;ACxCA,kC;AACA,wE;AACA,kB;AACA,mB;AACA,wB;AACA,gI;AACA,oB;AACA,sZ;AACA,iD;AACA,iB;AACA,uG;AACA,oD;AACA,I;;AAEA,8B;AACA,gE;AACA,kB;AACA,8D;AACA,oD;AACA,oD;AACA,mD;AACA,oD;AACA,mD;AACA,iB;AACA,I;;;;;;;;;;;;;;;;;;;ACzBA,sB;AACA,gC;AACA,6B;AACA,iC;AACA,S;AACA,O;AACA,C;;;;;;;;;;;;;;;;;;;;;;ACNA,8B;;AAEA,uB;AACA,6B;AACA,0B;AACA,O;AACA,G","sourcesContent":["Audits = new Mongo.Collection('audits');\n\nfunction getUser() {\n\tvar user;\n\tif (!Meteor.user()) {\n\t\tuser = \"guest\";\n\t} else {\n\t\tuser = Meteor.userId();\n\t}\n\treturn user;\n}\n\nfunction getTime() {\n        var now = new Date();\n        return now;\n}\n\nat = {\n\tcreateLog: function(msg) {\n\t\tvar tmpl = UI._templateInstance();\n\t\tvar uri = tmpl.firstNode.baseURI;\n\t\tvar tmplName = tmpl.view.name;\n\t\tconsole.log(tmpl);\n\t\tconsole.log(tmplName);\n\t\tauditTrail({\"event\": msg, \"user\": getUser(), \"page\": uri, \"template\": tmplName, \"time\": getTime()});\n\t}\n}\n\nRouter.onAfterAction(function auditRequests() {\n\tconsole.log(this);\n\tvar method = this.method;\n\tvar url = this.request.url;\n\tvar path = this.route._path;\n\tvar template = this.router._layout.name;\n\tvar user = getUser();\n\tconsole.log(method);\n\tauditTrail({\"event\": \"GET \"+path, \"user\": getUser(), \"page\": url, \"template\": template, \"time\": getTime()});\n}, {where: 'server'});\n\nauditTrail = function(obj) {\n\tAudits.insert(obj);\n}\n","\nTemplate.__checkName(\"reporting\");\nTemplate[\"reporting\"] = new Template(\"Template.reporting\", (function() {\n  var view = this;\n  return HTML.DIV({\n    \"class\": \"container\"\n  }, HTML.Raw('\\n        <h2>\\n            <i class=\"fa fa-area-chart\"></i> Reporting\\n        </h2>\\n\\n        '), HTML.TABLE({\n    \"class\": \"table\"\n  }, \"\\n            \", HTML.THEAD(\"\\n            \", HTML.TR(\"\\n                \", HTML.TH(\"\\n                    Event\\n                \"), \"\\n                \", HTML.TH(\"\\n                    User\\n                \"), \"\\n                \", HTML.TH(\"\\n                    Page\\n                \"), \"\\n            \"), \"\\n            \"), \"\\n            \", HTML.TBODY(\"\\n            \", Blaze.Each(function() {\n    return Spacebars.call(view.lookup(\"audits\"));\n  }, function() {\n    return [ \"\\n                \", Spacebars.include(view.lookupTemplate(\"audit\")), \"\\n            \" ];\n  }), \"\\n            \"), \"\\n        \"), \"\\n\\n    \");\n}));\n\nTemplate.__checkName(\"audit\");\nTemplate[\"audit\"] = new Template(\"Template.audit\", (function() {\n  var view = this;\n  return HTML.TR(\"\\n        \", HTML.TD(Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"event\"));\n  })), \"\\n        \", HTML.TD(Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"user\"));\n  })), \"\\n        \", HTML.TD(Blaze.View(function() {\n    return Spacebars.mustache(view.lookup(\"page\"));\n  })), \"\\n    \");\n}));\n","if (Meteor.isClient) {\n    Template.reporting.helpers({\n        audits: function () {\n            return Audits.find();\n        }\n    });\n}\n\n\n\n","console.log('router','route');\n\nRouter.map(function() {\n    this.route('reporting', {\n        path: '/reporting'\n    });\n});"]}