{"version":3,"file":"/packages/valedaemon:audit-trail.js","sources":["valedaemon:audit-trail/valedaemon:audit-trail.js","valedaemon:audit-trail/reporting.js"],"names":[],"mappings":";;;;;;;;AAAA,wC;;AAEA,oB;AACA,U;AACA,sB;AACA,iB;AACA,S;AACA,yB;AACA,E;AACA,C;;AAEA,M;AACA,2B;AACA,oC;AACA,mC;AACA,gC;AACA,oB;AACA,wB;AACA,mF;AACA,E;AACA,C;;AAEA,+C;AACA,0B;AACA,oB;AACA,sB;AACA,qB;AACA,+D;AACA,G;;AAEA,4B;AACA,oB;AACA,C;;;;;;;;;;;;;;;;;;AChCA,sB;AACA,gC;AACA,6B;AACA,iC;AACA,S;AACA,O;AACA,C","sourcesContent":["Audits = new Mongo.Collection('audits');\n\nfunction getUser() {\n\tvar user;\n\tif (!Meteor.user()) {\n\t\tuser = \"guest\";\n\t} else {\n\t\tuser = Meteor.userId();\n\t}\n}\n\nat = {\n\tcreateLog: function(msg) {\n\t\tvar tmpl = UI._templateInstance();\n\t\tvar uri = tmpl.firstNode.baseURI;\n\t\tvar tmplName = tmpl.view.name;\n\t\tconsole.log(tmpl);\n\t\tconsole.log(tmplName);\n\t\tauditTrail({\"event\": msg, \"user\": getUser(), \"page\": uri, \"template\": tmplName});\n\t}\n}\n\nRouter.onAfterAction(function auditRequests() {\n\tvar method = this.method;\n\tvar url = this.url;\n\tvar user = getUser();\n\tconsole.log(method);\n\tauditTrail({\"event\": method, \"user\": getUser(), \"page\": url});\n});\n\nauditTrail = function(obj) {\n\tAudits.insert(obj);\n}","if (Meteor.isClient) {\n    Template.reporting.helpers({\n        audits: function () {\n            return Audits.find();\n        }\n    });\n}\n\n\n\n"]}