{"version":3,"file":"/packages/valedaemon:audit-trail.js","sources":["valedaemon:audit-trail/valedaemon:audit-trail.js","valedaemon:audit-trail/reporting.js"],"names":[],"mappings":";;;;;;;;AAAA,wC;;AAEA,oB;AACA,U;AACA,sB;AACA,iB;AACA,S;AACA,yB;AACA,E;AACA,a;AACA,C;;AAEA,oB;AACA,6B;AACA,mB;AACA,C;;AAEA,M;AACA,2B;AACA,oC;AACA,mC;AACA,gC;AACA,oB;AACA,wB;AACA,sG;AACA,E;AACA,C;;AAEA,+C;AACA,mB;AACA,0B;AACA,4B;AACA,6B;AACA,yC;AACA,sB;AACA,qB;AACA,6G;AACA,sB;;AAEA,4B;AACA,oB;AACA,C;;;;;;;;;;;;;;;;;;;ACzCA,sB;AACA,gC;AACA,6B;AACA,iC;AACA,S;AACA,O;AACA,C","sourcesContent":["Audits = new Mongo.Collection('audits');\n\nfunction getUser() {\n\tvar user;\n\tif (!Meteor.user()) {\n\t\tuser = \"guest\";\n\t} else {\n\t\tuser = Meteor.userId();\n\t}\n\treturn user;\n}\n\nfunction getTime() {\n        var now = new Date();\n        return now;\n}\n\nat = {\n\tcreateLog: function(msg) {\n\t\tvar tmpl = UI._templateInstance();\n\t\tvar uri = tmpl.firstNode.baseURI;\n\t\tvar tmplName = tmpl.view.name;\n\t\tconsole.log(tmpl);\n\t\tconsole.log(tmplName);\n\t\tauditTrail({\"event\": msg, \"user\": getUser(), \"page\": uri, \"template\": tmplName, \"time\": getTime()});\n\t}\n}\n\nRouter.onAfterAction(function auditRequests() {\n\tconsole.log(this);\n\tvar method = this.method;\n\tvar url = this.request.url;\n\tvar path = this.route._path;\n\tvar template = this.router._layout.name;\n\tvar user = getUser();\n\tconsole.log(method);\n\tauditTrail({\"event\": \"GET \"+path, \"user\": getUser(), \"page\": url, \"template\": template, \"time\": getTime()});\n}, {where: 'server'});\n\nauditTrail = function(obj) {\n\tAudits.insert(obj);\n}\n","if (Meteor.isClient) {\n    Template.reporting.helpers({\n        audits: function () {\n            return Audits.find();\n        }\n    });\n}\n\n\n\n"]}